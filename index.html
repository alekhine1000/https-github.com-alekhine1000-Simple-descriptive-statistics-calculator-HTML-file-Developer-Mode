<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Descriptive Statistics Calculator</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    :root {
      color-scheme: light;
      --bg: #f1f5f9;
      --card: #ffffff;
      --ink: #0f172a;
      --muted: #64748b;
      --primary: #4f46e5;
      --primary-dark: #312e81;
      --accent: #f97316;
      --border: #e2e8f0;
      --shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      background: radial-gradient(circle at top, #eef2ff 0%, var(--bg) 60%);
      color: var(--ink);
      min-height: 100vh;
      padding: 32px 16px 60px;
    }

    .container {
      max-width: 1120px;
      margin: 0 auto;
      background: var(--card);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 32px;
    }

    header {
      text-align: center;
      margin-bottom: 28px;
    }

    header h1 {
      font-size: clamp(1.9rem, 3vw, 2.6rem);
      margin-bottom: 8px;
    }

    header p {
      color: var(--muted);
      margin: 0;
    }

    .instructions {
      background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
      padding: 16px 20px;
      border-radius: 14px;
      border-left: 5px solid var(--accent);
      margin-bottom: 24px;
      display: grid;
      gap: 6px;
      font-size: 0.95rem;
    }

    .upload-section {
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.12), rgba(79, 70, 229, 0.05));
      border: 1px dashed rgba(79, 70, 229, 0.35);
      padding: 22px;
      border-radius: 18px;
      display: grid;
      gap: 16px;
      margin-bottom: 20px;
    }

    .upload-section h3 {
      margin: 0;
      color: var(--primary-dark);
      font-size: 1.1rem;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .file-input {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #fff;
      border: 1px solid var(--border);
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .file-input input {
      border: none;
      font-size: 0.9rem;
    }

    select,
    button {
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      font-size: 0.9rem;
      background: #fff;
      color: var(--ink);
    }

    button {
      border: none;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 12px 18px rgba(79, 70, 229, 0.2);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .messages {
      min-height: 36px;
      margin-bottom: 16px;
    }

    .message {
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 0.9rem;
    }

    .message.success {
      background: #dcfce7;
      color: #166534;
      border: 1px solid rgba(22, 101, 52, 0.25);
    }

    .message.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid rgba(153, 27, 27, 0.25);
    }

    #dataPreview {
      display: none;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      font-family: "JetBrains Mono", "Courier New", monospace;
      font-size: 12px;
      overflow-x: auto;
      margin-bottom: 24px;
      background: #fff;
    }

    #dataPreview .preview-header {
      font-weight: 600;
      color: var(--muted);
      margin-bottom: 8px;
    }

    #results {
      display: none;
    }

    #results h3 {
      margin-bottom: 16px;
      font-size: 1.2rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 14px;
      margin-bottom: 22px;
    }

    .stat-card {
      padding: 16px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.9), rgba(49, 46, 129, 0.95));
      color: #fff;
      box-shadow: 0 12px 20px rgba(49, 46, 129, 0.18);
      display: grid;
      gap: 6px;
    }

    .stat-label {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      opacity: 0.85;
    }

    .stat-value {
      font-size: 22px;
      font-weight: 700;
    }

    .outlier-list {
      display: none;
      background: #fff1f2;
      border-left: 4px solid #fb7185;
      padding: 12px 14px;
      border-radius: 12px;
      font-family: "JetBrains Mono", "Courier New", monospace;
      font-size: 12px;
      margin-bottom: 22px;
    }

    .outlier-list strong {
      display: block;
      margin-bottom: 6px;
      color: #be123c;
    }

    .charts {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 22px;
    }

    .chart-card {
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
    }

    .chart-card h4 {
      margin: 0 0 12px;
      text-align: center;
      color: var(--primary-dark);
      font-weight: 600;
    }

    footer {
      margin-top: 28px;
      text-align: center;
      color: var(--muted);
      font-size: 12px;
    }

    @media (max-width: 720px) {
      .container {
        padding: 22px;
      }

      .controls {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìä Descriptive Statistics Calculator</h1>
      <p>Upload a CSV file and explore descriptive insights instantly.</p>
    </header>

    <section class="instructions">
      <strong>Quick start</strong>
      <span>1. Upload CSV ‚Üí 2. Pick numeric column ‚Üí 3. Analyze.</span>
      <small>Example headers: <code>Student_ID,Exam_Score</code></small>
    </section>

    <section class="upload-section">
      <h3>üóÇÔ∏è Upload your data</h3>
      <div class="controls">
        <label class="file-input">
          <span>Select CSV</span>
          <input type="file" id="csvFile" accept=".csv" />
        </label>
        <select id="columnSelect" disabled>
          <option value="">Select column to analyze...</option>
        </select>
        <button id="analyzeButton" disabled>Analyze column</button>
      </div>
    </section>

    <div id="messages" class="messages" aria-live="polite"></div>

    <section id="dataPreview">
      <div class="preview-header">Data Preview (First 5 rows)</div>
    </section>

    <section id="results">
      <h3>üìà Statistical Summary</h3>
      <div id="statsGrid" class="stats-grid"></div>

      <div id="outliersSection" class="outlier-list">
        <strong>üî¥ Detected Outliers</strong>
        <div id="outlierValues"></div>
      </div>

      <div class="charts">
        <div class="chart-card">
          <h4>Distribution Analysis</h4>
          <div id="histogram"></div>
        </div>
        <div class="chart-card">
          <h4>Box-Whiskers Plot Analysis</h4>
          <div id="boxplot"></div>
        </div>
      </div>
    </section>

    <footer>All calculations run locally in your browser.</footer>
  </div>

  <script>
    const state = {
      data: [],
      headers: [],
      numericHeaders: []
    };

    const csvInput = document.getElementById("csvFile");
    const columnSelect = document.getElementById("columnSelect");
    const analyzeButton = document.getElementById("analyzeButton");
    const messages = document.getElementById("messages");
    const dataPreview = document.getElementById("dataPreview");
    const results = document.getElementById("results");
    const statsGrid = document.getElementById("statsGrid");
    const outliersSection = document.getElementById("outliersSection");
    const outlierValues = document.getElementById("outlierValues");

    const numberFormatter = new Intl.NumberFormat("en-US", {
      maximumFractionDigits: 3
    });

    function showMessage(text, type) {
      messages.innerHTML = `<div class="message ${type}">${text}</div>`;
    }

    function parseCSV(text) {
      const rows = [];
      let currentRow = [];
      let currentField = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i += 1) {
        const char = text[i];
        const nextChar = text[i + 1];

        if (char === '"') {
          if (inQuotes && nextChar === '"') {
            currentField += '"';
            i += 1;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (char === "," && !inQuotes) {
          currentRow.push(currentField.trim());
          currentField = "";
        } else if ((char === "\n" || char === "\r") && !inQuotes) {
          if (currentField.length || currentRow.length) {
            currentRow.push(currentField.trim());
            rows.push(currentRow);
            currentRow = [];
            currentField = "";
          }
        } else {
          currentField += char;
        }
      }

      if (currentField.length || currentRow.length) {
        currentRow.push(currentField.trim());
        rows.push(currentRow);
      }

      if (rows.length < 2) {
        return null;
      }

      const headers = rows[0];
      const data = rows.slice(1).map(row => {
        const record = {};
        headers.forEach((header, index) => {
          record[header] = row[index] ?? "";
        });
        return record;
      });

      return { headers, data };
    }

    function normalizeNumber(value) {
      if (typeof value !== "string") {
        return Number(value);
      }

      const cleaned = value.replace(/,/g, "").trim();
      const numeric = Number(cleaned);
      return Number.isFinite(numeric) ? numeric : NaN;
    }

    function findNumericHeaders(headers, data) {
      return headers.filter(header => {
        const numericValues = data
          .map(row => normalizeNumber(row[header]))
          .filter(value => Number.isFinite(value));
        return numericValues.length >= 3;
      });
    }

    function renderPreview(headers, data) {
      let html = `<div class="preview-header">Data Preview (First 5 rows)</div>`;
      html += `<strong>${headers.join(" | ")}</strong><br />`;
      html += "‚Äî".repeat(60) + "<br />";
      data.slice(0, 5).forEach(row => {
        html += headers.map(header => row[header]).join(" | ") + "<br />";
      });
      dataPreview.innerHTML = html;
      dataPreview.style.display = "block";
    }

    function updateColumnSelect() {
      columnSelect.innerHTML = "<option value=\"\">Select column to analyze...</option>";
      state.numericHeaders.forEach(header => {
        const option = document.createElement("option");
        option.value = header;
        option.textContent = header;
        columnSelect.appendChild(option);
      });

      const hasColumns = state.numericHeaders.length > 0;
      columnSelect.disabled = !hasColumns;
      analyzeButton.disabled = !hasColumns;
    }

    function percentile(sorted, p) {
      const index = (sorted.length - 1) * p;
      const lower = Math.floor(index);
      const upper = Math.ceil(index);
      if (lower === upper) {
        return sorted[lower];
      }
      const weight = index - lower;
      return sorted[lower] + weight * (sorted[upper] - sorted[lower]);
    }

    function calculateStats(values) {
      const sorted = [...values].sort((a, b) => a - b);
      const n = sorted.length;
      const mean = sorted.reduce((sum, val) => sum + val, 0) / n;
      const variance = sorted.reduce((sum, val) => sum + (val - mean) ** 2, 0) / (n - 1);
      const stdDev = Math.sqrt(variance);

      const q1 = percentile(sorted, 0.25);
      const q2 = percentile(sorted, 0.5);
      const q3 = percentile(sorted, 0.75);
      const iqr = q3 - q1;
      const lowerFence = q1 - 1.5 * iqr;
      const upperFence = q3 + 1.5 * iqr;

      const skewness = n > 2
        ? (sorted.reduce((sum, val) => sum + ((val - mean) / stdDev) ** 3, 0) * n) /
          ((n - 1) * (n - 2))
        : 0;
      const kurtosis = n > 3
        ? ((n * (n + 1)) / ((n - 1) * (n - 2) * (n - 3))) *
            sorted.reduce((sum, val) => sum + ((val - mean) / stdDev) ** 4, 0) -
          (3 * (n - 1) ** 2) / ((n - 2) * (n - 3))
        : 0;

      const outliers = values.filter(val => val < lowerFence || val > upperFence);

      return {
        n,
        mean,
        variance,
        stdDev,
        q1,
        q2,
        q3,
        iqr,
        min: sorted[0],
        max: sorted[sorted.length - 1],
        range: sorted[sorted.length - 1] - sorted[0],
        skewness,
        kurtosis,
        lowerFence,
        upperFence,
        outliers
      };
    }

    function formatStat(value, digits = 2) {
      if (!Number.isFinite(value)) {
        return "‚Äì";
      }
      return Number(value.toFixed(digits)).toLocaleString("en-US");
    }

    function displayStats(stats) {
      const cards = [
        { label: "Mean", value: formatStat(stats.mean) },
        { label: "Q1", value: formatStat(stats.q1) },
        { label: "Median", value: formatStat(stats.q2) },
        { label: "Q3", value: formatStat(stats.q3) },
        { label: "IQR", value: formatStat(stats.iqr) },
        { label: "Std Dev", value: formatStat(stats.stdDev) },
        { label: "Min", value: formatStat(stats.min, 1) },
        { label: "Max", value: formatStat(stats.max, 1) },
        { label: "Skewness", value: formatStat(stats.skewness, 3) },
        { label: "Kurtosis", value: formatStat(stats.kurtosis, 3) },
        { label: "Outliers", value: stats.outliers.length.toString() },
        { label: "Sample Size", value: stats.n.toString() }
      ];

      if (stats.outliers.length) {
        cards.push(
          { label: "Lower Fence", value: formatStat(stats.lowerFence) },
          { label: "Upper Fence", value: formatStat(stats.upperFence) }
        );
      }

      statsGrid.innerHTML = cards
        .map(card => `
          <div class="stat-card">
            <div class="stat-label">${card.label}</div>
            <div class="stat-value">${card.value}</div>
          </div>
        `)
        .join("");
    }

    function displayOutliers(outliers) {
      if (!outliers.length) {
        outliersSection.style.display = "none";
        return;
      }
      outlierValues.textContent = outliers.map(value => numberFormatter.format(value)).join(", ");
      outliersSection.style.display = "block";
    }

    function createHistogram(data, stats, columnName) {
      const numBins = Math.max(5, Math.min(30, Math.ceil(Math.sqrt(stats.n))));
      const histogramTrace = {
        x: data,
        type: "histogram",
        nbinsx: numBins,
        marker: { color: "rgba(79, 70, 229, 0.75)", line: { color: "#312e81", width: 1 } }
      };

      const x = [];
      const y = [];
      const step = (stats.max - stats.min) / 200 || 1;
      for (let i = stats.min - 3 * stats.stdDev; i <= stats.max + 3 * stats.stdDev; i += step) {
        x.push(i);
        const norm =
          (1 / (stats.stdDev * Math.sqrt(2 * Math.PI))) *
          Math.exp(-0.5 * ((i - stats.mean) / stats.stdDev) ** 2);
        y.push(norm * stats.n * ((stats.max - stats.min) / numBins));
      }

      const normalTrace = {
        x,
        y,
        type: "scatter",
        mode: "lines",
        line: { color: "#f97316", width: 2 }
      };

      Plotly.newPlot("histogram", [histogramTrace, normalTrace], {
        title: `Distribution Analysis: ${columnName}`,
        xaxis: { title: columnName, gridcolor: "rgba(148, 163, 184, 0.3)" },
        yaxis: { title: "Frequency", gridcolor: "rgba(148, 163, 184, 0.3)" },
        showlegend: false,
        margin: { t: 60, r: 20, b: 50, l: 50 }
      });
    }

    function createBoxPlot(data, columnName) {
      const trace = {
        y: data,
        type: "box",
        name: columnName,
        marker: { color: "#f97316", size: 6, line: { color: "#1e3a8a", width: 1 } },
        line: { color: "#1e3a8a", width: 2 },
        fillcolor: "#bfdbfe",
        quartilemethod: "linear",
        boxpoints: "outliers"
      };

      Plotly.newPlot("boxplot", [trace], {
        title: `Box-Whiskers Plot Analysis: ${columnName}`,
        yaxis: { gridcolor: "rgba(148, 163, 184, 0.3)", zeroline: false },
        xaxis: { showticklabels: false },
        showlegend: false,
        margin: { l: 70, r: 40, t: 60, b: 40 },
        height: 520,
        plot_bgcolor: "white",
        paper_bgcolor: "white"
      });
    }

    function analyzeColumn() {
      const columnName = columnSelect.value;
      if (!columnName) {
        return;
      }

      const values = state.data
        .map(row => normalizeNumber(row[columnName]))
        .filter(value => Number.isFinite(value));

      if (values.length < 3) {
        showMessage("Need at least 3 numeric values for statistics.", "error");
        return;
      }

      const stats = calculateStats(values);
      displayStats(stats);
      displayOutliers(stats.outliers);
      createHistogram(values, stats, columnName);
      createBoxPlot(values, columnName);
      results.style.display = "block";
      showMessage("Analysis complete.", "success");
    }

    csvInput.addEventListener("change", event => {
      const file = event.target.files[0];
      if (!file) {
        return;
      }

      if (!file.name.toLowerCase().endsWith(".csv")) {
        showMessage("Please upload a CSV file.", "error");
        return;
      }

      const reader = new FileReader();
      reader.onload = evt => {
        const result = parseCSV(evt.target.result);
        if (!result || !result.data.length) {
          showMessage("Could not parse the CSV file.", "error");
          return;
        }

        state.data = result.data;
        state.headers = result.headers;
        state.numericHeaders = findNumericHeaders(result.headers, result.data);

        renderPreview(result.headers, result.data);
        updateColumnSelect();
        results.style.display = "none";

        if (state.numericHeaders.length) {
          showMessage("File loaded. Select a column and click Analyze.", "success");
        } else {
          showMessage("No numeric columns found with at least 3 values.", "error");
        }
      };

      reader.readAsText(file);
    });

    columnSelect.addEventListener("change", () => {
      analyzeButton.disabled = !columnSelect.value;
    });

    analyzeButton.addEventListener("click", analyzeColumn);
  </script>
</body>
</html>
